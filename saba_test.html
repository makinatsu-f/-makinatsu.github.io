<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚µãƒã‚¿ãƒƒãƒ—ã‚²ãƒ¼ãƒ </title>
  <style>/* ===== HUDï¼ˆä¸Šã®è¡¨ç¤ºï¼‰===== */
#hud{
  position: fixed;
  left: 12px;
  top: calc(env(safe-area-inset-top) + 48px);
  z-index: 99999;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Noto Sans JP", sans-serif;
  text-shadow: 0 2px 6px rgba(0,0,0,.35);
  user-select: none;
}

#title{
  font-weight: 800;
  font-size: 18px;
  margin-bottom: 8px;
}

#scoreRow{
  display: flex;
  gap: 10px;
  align-items: center;
  margin-top: 8px; /* â† è¿½åŠ  */
}

#scoreBox{
  font-weight: 900;
  font-size: 20px;
  letter-spacing: .3px;
  padding: 8px 12px;
  border-radius: 12px;
  background: rgba(0,0,0,.18);
  backdrop-filter: blur(6px);
}

#resetBtn{
  font-weight: 800;
  font-size: 16px;
  padding: 10px 14px;
  border-radius: 12px;
  border: 0;
  color: #073b4c;
  background: rgba(255,255,255,.92);
  box-shadow: 0 6px 16px rgba(0,0,0,.25);
  cursor: pointer;
}

#resetBtn:active{
  transform: scale(0.98);
}

    * { box-sizing: border-box; }
    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      background: #003f7f;
      font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic", sans-serif;
    }

    #scoreBox{
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 28px;
      font-weight: 800;
      color: white;
      z-index: 9999;
      text-shadow: 0 2px 8px rgba(0,0,0,.25);
      user-select: none;
    }

    .sea {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(#3fa9f5, #003f7f);
      overflow: hidden;
      touch-action: manipulation;
    }

    .fish {
      position: absolute;
      user-select: none;
      -webkit-user-drag: none;
      cursor: pointer;

      /* ã€Œè¦‹ãŸç›®ã‚ˆã‚Šã‚¿ãƒƒãƒ—åˆ¤å®šã‚’å¤§ããã€ã™ã‚‹é­”æ³•ğŸª„ */
      padding: 18px;
      margin: -18px;
    }

    /* ã¡ã‚‡ã„æ¥½ã—ã„æ¼”å‡º */
    .pop {
      transform: scale(1.08);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
      transition: transform .08s;
    }
  </style>
</head>
<body>
<div id="hud">
  <div id="title">ã‚µãƒã‚¿ãƒƒãƒ—ã‚²ãƒ¼ãƒ </div>

  <div id="scoreRow">
    <div id="scoreBox">SCORE: <span id="score">0</span></div>
    <button id="resetBtn" type="button">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>

<div class="sea" id="sea"></div>


<div class="sea" id="sea"></div>

  <script>
    // ===== è¨­å®š =====
    const sea = document.getElementById("sea");
    const scoreSpan = document.getElementById("score");

    let score = 0;
    const fishes = []; // { el, type, x, y, speed, alive }
const resetBtn = document.getElementById("resetBtn");

function resetGame() {
  score = 0;
  scoreSpan.textContent = score;

  // ç”»é¢ä¸Šã®é­šã‚’å…¨éƒ¨æ¶ˆã™
  fishes.forEach(f => f.el.remove());
  fishes.length = 0; // é…åˆ—ã‚‚ç©ºã«ã™ã‚‹
}

resetBtn.addEventListener("click", resetGame);

    // å‡ºç¾é–“éš”ï¼ˆå°ã•ã„ã»ã©å¤šã„ï¼‰
    const SPAWN_INTERVAL = 650;

    // ç”»é¢å¤–ã®ä½™ç™½ï¼ˆå¤§ãã„é­šã«åˆã‚ã›ã¦å°‘ã—å¤šã‚ï¼‰
    const OFFSCREEN = 260;

    // åŒæ™‚ã«å¢—ãˆã™ããªã„ä¿é™º
    const MAX_FISH_ON_SCREEN = 16;

    // ã€ŒãŸã¾ã«çˆ†é€Ÿã€ç¢ºç‡
    const RARE_FAST_CHANCE = 0.08; // 8%
    const RARE_FAST_MULT = 2.8;

    // ã€ŒãŸã¾ã«ã‚µãƒã®ç¾¤ã‚Œã€ç¢ºç‡
    const SABA_SCHOOL_CHANCE = 0.10; // 10%
    const SABA_SCHOOL_COUNT_MIN = 5;
    const SABA_SCHOOL_COUNT_MAX = 9;

    // é­šã®ç¨®é¡ï¼ˆsize=é«˜ã•px, points=å¾—ç‚¹, weight=å‡ºã‚„ã™ã•, speed=[min,max]ï¼‰
    // â€»å°ã•ã™ãã¦ã‚¿ãƒƒãƒ—ã—ã¥ã‚‰ã„â†’ size ã‚’ä¸Šã’ã‚‹
    const FISH_TYPES = [
      { name:"saba",     src:"images/saba.png",     points:1,  size:110, weight:60, speed:[1.7, 3.0] },
      { name:"tai",      src:"images/tai.png",      points:2,  size:125, weight:22, speed:[1.6, 2.8] },
      { name:"maguro",   src:"images/maguro.png",   points:3,  size:140, weight:16, speed:[2.2, 3.8] },

      // ãƒ¬ã‚¢æ ï¼ˆå¤§ãã‚ãƒ»é«˜å¾—ç‚¹ï¼‰
      { name:"jinbe",    src:"images/jinbe.png",    points:12, size:210, weight:3,  speed:[1.2, 2.0] },
      { name:"hohojiro", src:"images/hohojiro.png", points:9,  size:185, weight:4,  speed:[2.8, 4.8] },
    ];

    function rand(min, max){ return Math.random() * (max - min) + min; }
    function randi(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }

    function pickFishType(){
      const total = FISH_TYPES.reduce((a,t)=>a+t.weight,0);
      let r = Math.random() * total;
      for(const t of FISH_TYPES){
        r -= t.weight;
        if(r <= 0) return t;
      }
      return FISH_TYPES[0];
    }

    function updateScore(add){
      score += add;
      scoreSpan.textContent = String(score);
    }

    function spawnOne(typeOverride=null, yOverride=null, speedOverride=null){
      if(fishes.length >= MAX_FISH_ON_SCREEN) return;

      const type = typeOverride ?? pickFishType();

      const img = document.createElement("img");
      img.src = type.src;
      img.alt = type.name;
      img.className = "fish";
      img.style.height = type.size + "px";

      const seaW = sea.clientWidth;
      const seaH = sea.clientHeight;

      // å³ã‹ã‚‰å·¦ã«æ³³ãï¼ˆé ­ãŒå·¦ã®ç”»åƒã«åˆã†ï¼‰
      const x = seaW + rand(20, OFFSCREEN);

      // ä¸Šä¸‹ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆç«¯ã£ã“è¡Œãã™ãé˜²æ­¢ï¼‰
      const y = (yOverride != null)
        ? yOverride
        : rand(30, Math.max(40, seaH - type.size - 30));

      let speed = speedOverride != null
        ? speedOverride
        : rand(type.speed[0], type.speed[1]);

      // ãŸã¾ã«çˆ†é€Ÿã«ãªã‚‹ï¼ˆã©ã®é­šã§ã‚‚ï¼‰
      if(Math.random() < RARE_FAST_CHANCE){
        speed *= RARE_FAST_MULT;
      }

      img.style.left = x + "px";
      img.style.top  = y + "px";

      const fishObj = { el: img, type, x, y, speed, alive: true };

      // ã‚¿ãƒƒãƒ—ã§æ¶ˆã™ + ã‚¹ã‚³ã‚¢åŠ ç®—
      function catchIt(ev){
        ev.preventDefault?.();

        if(!fishObj.alive) return;
        fishObj.alive = false;

        img.classList.add("pop");
        updateScore(type.points);

        // æ¶ˆã™ï¼ˆå°‘ã—ã ã‘ä½™éŸ»ï¼‰
        setTimeout(()=>{
          img.remove();
        }, 60);
      }

      img.addEventListener("click", catchIt);
      img.addEventListener("touchstart", catchIt, { passive:false });

      sea.appendChild(img);
      fishes.push(fishObj);
    }

    function spawnFish(){
      // ãŸã¾ã«ã€Œã‚µãƒã®ç¾¤ã‚Œã€ãƒ‰ãƒ‰ãƒ‰ãƒƒ
      if(Math.random() < SABA_SCHOOL_CHANCE){
        const n = randi(SABA_SCHOOL_COUNT_MIN, SABA_SCHOOL_COUNT_MAX);
        const seaH = sea.clientHeight;

        const baseY = rand(60, Math.max(80, seaH - 220));
        for(let i=0;i<n;i++){
          const y = baseY + rand(-60, 60);
          const speed = rand(2.2, 4.2) + i*0.08; // ã¡ã‚‡ã„éšŠåˆ—æ„Ÿ
          spawnOne(FISH_TYPES[0], y, speed); // sabaå›ºå®š
        }
        return;
      }

      spawnOne();
    }

    function tick(){
      const seaW = sea.clientWidth;

      for(let i=fishes.length-1; i>=0; i--){
        const f = fishes[i];

        if(!f.alive){
          fishes.splice(i,1);
          continue;
        }

        // å³ -> å·¦ã¸
        f.x -= f.speed;
        f.el.style.left = f.x + "px";

        // å·¦ã«å‡ºãŸã‚‰æ¶ˆã™
        if(f.x < -OFFSCREEN){
          f.el.remove();
          fishes.splice(i,1);
        }
      }

      requestAnimationFrame(tick);
    }

    // é–‹å§‹
    setInterval(spawnFish, SPAWN_INTERVAL);
    requestAnimationFrame(tick);
  </script>
</body>
</html>

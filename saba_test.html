<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>サバタップゲーム</title>

  <style>
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic", sans-serif;
      background: #003f7f;
    }

    /* 海（画面全体） */
    .sea {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      background: linear-gradient(#3fa9f5, #003f7f);
    }

    /* スコア表示 */
    #scoreBox {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 9999;
      color: white;
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.35);
      pointer-events: none;
    }

    /* 魚 */
    .fish {
      position: absolute;
      height: 80px; /* 大きさはここで調整 */
      width: auto;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      pointer-events: auto;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,0.22));
      transition: transform 80ms ease;
    }
    .fish:active {
      transform: scale(0.92);
    }

    /* ちょい説明（任意） */
    #hint {
      position: absolute;
      bottom: 12px;
      left: 12px;
      z-index: 9999;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      pointer-events: none;
      text-shadow: 0 2px 10px rgba(0,0,0,0.25);
    }
  </style>
</head>

<body>
  <div class="sea" id="sea">
    <div id="scoreBox">SCORE: <span id="score">0</span></div>
    <div id="hint">魚をタップ！</div>
  </div>

  <script>
    // =========================
    // 設定
    // =========================
    const sea = document.getElementById("sea");
    const scoreEl = document.getElementById("score");

    let score = 0;
    let fishList = [];   // 画面にいる魚たち
    let running = true;

    const MAX_FISH = 14;         // 画面に出せる最大数
    const SPAWN_INTERVAL = 650;  // 出現頻度（ms）
    const MIN_SPEED = 1.6;       // 最低速度
    const MAX_SPEED = 4.6;       // 最高速度

    // 魚の種類（画像は images/ に置く）
    // まず saba.png だけでも動く（他が無ければ自動で saba にフォールバックする）
    const FISH_TYPES = [
      { name: "saba",   src: "images/saba.png",   points: 1, weight: 70 },
      { name: "maguro", src: "images/maguro.png", points: 3, weight: 20 },
      { name: "tai",    src: "images/tai.png",    points: 5, weight: 10 },
    ];

    // 乱数ヘルパ
    const rand = (min, max) => Math.random() * (max - min) + min;

    // 重み付き抽選
    function pickFish() {
      const total = FISH_TYPES.reduce((a, f) => a + f.weight, 0);
      let r = Math.random() * total;
      for (const f of FISH_TYPES) {
        r -= f.weight;
        if (r <= 0) return f;
      }
      return FISH_TYPES[0];
    }

    function setScore(n) {
      score = n;
      scoreEl.textContent = String(score);
    }

    // =========================
    // 魚を出す
    // =========================
    function spawnFish() {
      if (!running) return;
      if (fishList.length >= MAX_FISH) return;

      const fishType = pickFish();

      const img = document.createElement("img");
      img.className = "fish";
      img.alt = fishType.name;
      img.src = fishType.src;

      // 画像が無かったらサバに差し替え（壊れ画像を防ぐ）
      img.onerror = () => {
        img.onerror = null;
        img.src = "images/saba.png";
        img.alt = "saba";
      };

      const seaW = sea.clientWidth;
      const seaH = sea.clientHeight;

      // 右から左へ（頭が左の画像に合わせる）
      const y = rand(40, Math.max(80, seaH - 140));
      const speed = rand(MIN_SPEED, MAX_SPEED);

      // 右の外側からスタート
      const startX = seaW + rand(20, 240);

      img.style.left = startX + "px";
      img.style.top = y + "px";

      sea.appendChild(img);

      const fishObj = {
        el: img,
        x: startX,
        y: y,
        speed: speed,
        alive: true,
        points: fishType.points
      };

      // タップで捕獲（消えて +点）
      img.addEventListener("click", () => catchFish(fishObj), { passive: true });

      fishList.push(fishObj);
    }

    // =========================
    // 捕獲
    // =========================
    function catchFish(fishObj) {
      if (!fishObj.alive) return;
      fishObj.alive = false;

      setScore(score + fishObj.points);

      // 消す
      fishObj.el.remove();

      // 配列からも消す
      fishList = fishList.filter(f => f.alive);
    }

    // =========================
    // 動かす（右→左）
    // =========================
    function tick() {
      if (!running) return;

      const seaW = sea.clientWidth;

      for (const f of fishList) {
        if (!f.alive) continue;

        // 右から左へ進む
        f.x -= f.speed;

        // 画面の左に出たら、右側にワープして再登場
        if (f.x < -180) {
          f.x = seaW + rand(40, 260);
        }

        f.el.style.left = f.x + "px";
      }

      requestAnimationFrame(tick);
    }

    // =========================
    // 起動
    // =========================
    setScore(0);

    // まず数匹出す
    for (let i = 0; i < 6; i++) spawnFish();

    // 定期的に増やす
    setInterval(spawnFish, SPAWN_INTERVAL);

    // アニメ開始
    requestAnimationFrame(tick);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>サバタップゲーム</title>

  <style>
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic", sans-serif;
      background: #003f7f;
    }

    /* 海（画面全体） */
    .sea {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      background: linear-gradient(#3fa9f5, #003f7f);
    }

    /* スコア表示 */
    #scoreBox {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 9999;
      color: white;
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.35);
      pointer-events: none;
    }

    /* 魚 */
    .fish {
      position: absolute;
      height: 80px; /* 大きさはここで調整 */
      width: auto;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      pointer-events: auto;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,0.22));
      transition: transform 80ms ease;
    }
    .fish:active {
      transform: scale(0.92);
    }

    /* ちょい説明（任意） */
    #hint {
      position: absolute;
      bottom: 12px;
      left: 12px;
      z-index: 9999;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      pointer-events: none;
      text-shadow: 0 2px 10px rgba(0,0,0,0.25);
    }
  </style>
</head>

<body>
  <div class="sea" id="sea">
    <div id="scoreBox">SCORE: <span id="score">0</span></div>
    <div id="hint">魚をタップ！</div>
  </div>

  <script>
    <script>
/* =========================
   サバタップゲーム（複数魚＋レア演出）
   右→左に流れて、タップで消えてスコア加算
   ========================= */

(() => {
  // ===== 設定 =====
  const SPAWN_INTERVAL = 650;     // 出現間隔(ms) 小さいほど多い
  const OFFSCREEN = 200;          // 画面外判定の余白(px)
  const MAX_FISH_ON_SCREEN = 14;  // 同時に出す最大数（重くなりすぎ防止）

  // 魚の種類（weight=出やすさ, points=得点, size=高さpx, speed=基本スピード範囲）
  const FISH_TYPES = [
    { name: "saba",      src: "images/saba.png",      weight: 60, points: 1,  size: 44,  speed: [2, 5] },
    { name: "tai",       src: "images/tai.png",       weight: 22, points: 3,  size: 52,  speed: [2, 6] },
    { name: "maguro",    src: "images/maguro.png",    weight: 14, points: 5,  size: 64,  speed: [3, 7] },

    // レア枠
    { name: "jinbe",     src: "images/jinbe.png",     weight: 3,  points: 12, size: 110, speed: [1, 2] }, // 基本ゆっくり
    { name: "hohojiro",  src: "images/hohojiro.png",  weight: 3,  points: 15, size: 95,  speed: [4, 9] }, // 速め
  ];

  // ===== 要素取得 =====
  const sea = document.querySelector(".sea") || document.body;
  const scoreSpan = document.getElementById("score");       // 推奨: <span id="score">0</span>
  const scoreBox = document.getElementById("scoreBox");     // あるなら更新補助に使う

  // ===== 状態 =====
  let score = 0;
  const fishes = []; // { el, type, x, y, speed, alive }

  // ===== スタイル注入（ホホジロの揺れ演出） =====
  const style = document.createElement("style");
  style.textContent = `
    .sea { position: relative; overflow: hidden; touch-action: manipulation; }
    .fish { position: absolute; user-select: none; -webkit-user-drag: none; cursor: pointer; }
    .shake {
      animation: shake 180ms linear 1;
    }
    @keyframes shake {
      0% { transform: translate(0,0); }
      20% { transform: translate(-6px, 2px); }
      40% { transform: translate(5px, -2px); }
      60% { transform: translate(-4px, -1px); }
      80% { transform: translate(3px, 2px); }
      100% { transform: translate(0,0); }
    }
  `;
  document.head.appendChild(style);

  // ===== 便利関数 =====
  const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

  function updateScore() {
    if (scoreSpan) scoreSpan.textContent = String(score);
    // scoreSpan が無い構造でも見えるように保険
    if (!scoreSpan && scoreBox) scoreBox.textContent = "SCORE: " + score;
  }

  function pickFishType() {
    const total = FISH_TYPES.reduce((a, f) => a + f.weight, 0);
    let r = Math.random() * total;
    for (const f of FISH_TYPES) {
      r -= f.weight;
      if (r <= 0) return f;
    }
    return FISH_TYPES[0];
  }

  function shakeSea() {
    sea.classList.remove("shake");
    // 付け直しのために1フレーム待つ
    requestAnimationFrame(() => sea.classList.add("shake"));
    setTimeout(() => sea.classList.remove("shake"), 220);
  }

  function fishCountAlive() {
    return fishes.filter(f => f.alive).length;
  }

  // ===== 魚生成 =====
  function spawnFish() {
    if (fishCountAlive() >= MAX_FISH_ON_SCREEN) return;

    const type = pickFishType();

    const seaW = sea.clientWidth || window.innerWidth;
    const seaH = sea.clientHeight || window.innerHeight;

    const img = document.createElement("img");
    img.src = type.src;
    img.alt = type.name;
    img.className = "fish";

    // サイズ（少しだけブレを作る）
    const sizeJitter = rand(-6, 10);
    const h = Math.max(28, type.size + sizeJitter);
    img.style.height = h + "px";

    // 位置（右からスタート、Yはランダム）
    const x = seaW + rand(20, 220);
    const y = rand(30, Math.max(30, seaH - h - 30));

    // スピード（基本）
    let speed = rand(type.speed[0] * 10, type.speed[1] * 10) / 10;

    // ジンベエだけ「基本ゆっくり、たまにターボ」
    // 15%でターボ個体にする
    let turbo = false;
    if (type.name === "jinbe" && Math.random() < 0.15) {
      turbo = true;
      speed = rand(14, 22) / 1; // ドーン！速い
      img.style.height = Math.round(h * 1.1) + "px"; // ちょいデカく
      img.style.filter = "drop-shadow(0 0 10px rgba(255,255,255,0.35))";
    }

    // ホホジロは出現時に揺れ
    if (type.name === "hohojiro") {
      shakeSea();
    }

    img.style.left = x + "px";
    img.style.top = y + "px";

    // オブジェクト化
    const fishObj = { el: img, type, x, y, speed, alive: true, turbo };

    // タップで捕獲（スマホもOKな pointerdown）
    const catchFish = (ev) => {
      ev.preventDefault();

      if (!fishObj.alive) return;
      fishObj.alive = false;

      // スコア加算（ターボジンベエはボーナス）
      const add = fishObj.turbo ? (fishObj.type.points + 8) : fishObj.type.points;
      score += add;
      updateScore();

      // 消す（ふわっと）
      fishObj.el.style.transition = "transform 120ms ease, opacity 120ms ease";
      fishObj.el.style.transform = "scale(1.15)";
      fishObj.el.style.opacity = "0";

      setTimeout(() => {
        fishObj.el.remove();
      }, 140);
    };

    img.addEventListener("pointerdown", catchFish, { passive: false });
    img.addEventListener("click", catchFish, { passive: false }); // 念のため

    sea.appendChild(img);
    fishes.push(fishObj);
  }

  // ===== アニメ更新 =====
  function tick() {
    const seaW = sea.clientWidth || window.innerWidth;

    for (const f of fishes) {
      if (!f.alive) continue;

      // 右→左へ
      f.x -= f.speed;
      f.el.style.left = f.x + "px";

      // 画面外に出たら消す
      if (f.x < -OFFSCREEN) {
        f.alive = false;
        f.el.remove();
      }
    }

    requestAnimationFrame(tick);
  }

  // ===== 開始 =====
  updateScore();
  setInterval(spawnFish, SPAWN_INTERVAL);

  // 最初に少しだけ出して賑やかに
  for (let i = 0; i < 6; i++) setTimeout(spawnFish, i * 120);

  requestAnimationFrame(tick);
})();
</script>

</body>
</html>

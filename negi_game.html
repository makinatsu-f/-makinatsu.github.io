<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒã‚®åç©«ã‚²ãƒ¼ãƒ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN",
        "Yu Gothic", sans-serif;
      background-color: #f7f3e9;
      color: #553322;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
   background-image: url("images/bg_negi_field.png");
background-size: cover;
background-position: center;
    }

    .wrapper {
      max-width: 480px;
      margin: 0 auto;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚¾ãƒ¼ãƒ³ï¼ˆä¸Šï¼‰ */
    .hud {
      text-align: center;
      padding: 10px 0 4px;
    }

    .score {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.08em;
      padding: 4px 12px;
      border-radius: 999px;
      border: 2px solid #ffb15a;
      display: inline-block;
      background: rgba(255, 248, 235, 0.9);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
    }

    .score span {
      min-width: 60px;
      display: inline-block;
      text-align: right;
    }

    .status-text {
      margin-top: 4px;
      font-size: 12px;
      color: #aa7744;
      min-height: 1.4em;
    }

    /* ã‚²ãƒ¼ãƒ ã‚¾ãƒ¼ãƒ³ï¼ˆçœŸã‚“ä¸­ï¼‰ */
    #game-area {
      position: relative;
      flex: 1;
      overflow: hidden;
      background-image: url("bg_negi_field.png");
      background-size: cover;
      background-position: center bottom;
      border-top: 2px solid #e2c9a3;
      border-bottom: 2px solid #e2c9a3;
    }

    .lane-helper {
      position: absolute;
      left: 0;
      right: 0;
      top: 52%;
      transform: translateY(-50%);
      height: 0;
    }

    .leek {
      position: absolute;
      bottom: 6vh; /* ç•‘ã®ä¸Šã«ã¡ã‚‡ã“ã‚“ã¨ç«‹ã¤æ„Ÿã˜ */
      width: 18vw;
      max-width: 120px;
      transform: translateY(0);
      cursor: pointer;
      touch-action: manipulation;
      transition: transform 0.1s;
    }

    .leek:active {
      transform: translateY(3px) scale(0.97);
    }

    .invincible .score {
      animation: glow 0.6s ease-in-out infinite alternate;
      border-color: #ffd700;
    }

    @keyframes glow {
      from { box-shadow: 0 0 6px rgba(255, 215, 0, 0.5); }
      to   { box-shadow: 0 0 14px rgba(255, 215, 0, 1); }
    }

    /* ãƒœã‚¿ãƒ³ã‚¾ãƒ¼ãƒ³ï¼ˆä¸‹ï¼‰ */
    .controls {
      padding: 10px 16px 18px;
      text-align: center;
    }

    .btn-main {
      display: inline-block;
      padding: 10px 26px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(180deg, #ffb15a, #ff8b3d);
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.08em;
      box-shadow: 0 4px 0 #d96c23;
      cursor: pointer;
    }

    .btn-main:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #d96c23;
    }

    .btn-sub {
      margin-top: 8px;
      font-size: 12px;
      color: #997755;
      background: none;
      border: none;
      text-decoration: underline;
      cursor: pointer;
    }

    .small-note {
      margin-top: 4px;
      font-size: 10px;
      color: #b2997c;
    }
#rule-text {
    text-align: center;
    font-size: 1.1rem;
    line-height: 1.6;
    color: #553322;
    font-weight: bold;
    margin-top: 10px;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 12px;
    backdrop-filter: blur(4px);
}  </style>
</head>
<body>
  <div class="wrapper">
    <!-- ä¸Šï¼šã‚¹ã‚³ã‚¢ -->
    <header class="hud">
      <div class="score">
        SCORE: <span id="score-value">0</span>
      </div>
      <div class="status-text" id="status-text"></div>
   <div id="rule-text">
    æ¯ã‚Œãƒã‚®ãƒ»æŠ˜ã‚Œãƒã‚®ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å–ã‚Šé™¤ã“ã†ï¼<br>
    é‡‘ãƒã‚®ã¯ã‚¿ãƒƒãƒ—ã§ +10ç‚¹ ï¼† 5ç§’é–“ãƒŸã‚¹ã—ã¦ã‚‚æ¸›ç‚¹ãªã—âœ¨
</div>
 </header>

    <!-- ä¸­ï¼šã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
    <main id="game-area">
      <div class="lane-helper" id="lane-helper"></div>
    </main>

    <!-- ä¸‹ï¼šãƒœã‚¿ãƒ³ -->
    <footer class="controls">
      <button id="start-btn" class="btn-main">åç©«é–‹å§‹ï¼</button>
      <button id="retry-btn" class="btn-sub" style="display:none;">ãƒªãƒˆãƒ©ã‚¤</button>
      <div class="small-note">
        æ¯ã‚Œãƒã‚®ãƒ»æŠ˜ã‚Œãƒã‚®ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å–ã‚Šé™¤ã“ã†ï¼<br />
        é‡‘ãƒã‚®ã¯ã‚¿ãƒƒãƒ—ã§ +10ç‚¹ ï¼† 5ç§’é–“ãƒŸã‚¹ã—ã¦ã‚‚æ¸›ç‚¹ãªã—âœ¨
      </div>
    </footer>
  </div>

  <script>
  // ==== ç”»åƒã¨ãƒã‚®ã‚¿ã‚¤ãƒ—è¨­å®š =========================
const NEGI_TYPES = {
  good: [
    { name: "ç´°ãƒã‚®",  file: "negi_hoso.png" },
    { name: "æ™®é€šãƒã‚®", file: "negi_futsu.png" },
    { name: "å¤ªãƒã‚®",  file: "negi_futo.png" }
  ],
  bad: [
    { name: "æ¯ã‚Œãƒã‚®", file: "negi_kare.png" },
    { name: "æŠ˜ã‚Œãƒã‚®", file: "negi_ore.png" }
  ],
  gold: [
    { name: "é‡‘ãƒã‚®", file: "negi_gold.png" }
  ]
};

    // ==== DOMå–å¾— =======================
    const gameArea = document.getElementById("game-area");
    const laneHelper = document.getElementById("lane-helper");
    const scoreValueEl = document.getElementById("score-value");
    const statusTextEl = document.getElementById("status-text");
    const startBtn = document.getElementById("start-btn");
    const retryBtn = document.getElementById("retry-btn");
    const bodyEl = document.body;

    // ==== ã‚²ãƒ¼ãƒ çŠ¶æ…‹ =====================
    let score = 0;
    let gameRunning = false;
    let leeks = [];
    let spawnTimer = null;
    let moveTimer = null;
    let speed = 2;           // åˆæœŸã‚¹ãƒ”ãƒ¼ãƒ‰ï¼ˆpx / frameï¼‰
    let speedLevelTimer = null;
    let invincible = false;
    let invincibleTimeoutId = null;

    const SPAWN_INTERVAL = 800; // æ–°ã—ã„ãƒã‚®ãŒå‡ºã‚‹é–“éš”(ms)
    const BASE_SPEED = 2;
    const SPEED_UP_INTERVAL = 12000; // 12ç§’ã”ã¨ã«ã‚¹ãƒ”ãƒ¼ãƒ‰UP
    const SPEED_UP_AMOUNT = 0.5;

    // ==== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====================
    function updateScore(delta) {
      score += delta;
      if (score < 0) score = 0;
      scoreValueEl.textContent = score;
    }

    function setStatusText(text) {
      statusTextEl.textContent = text || "";
    }

    function clearAllLeeks() {
      leeks.forEach(obj => {
        if (obj.el && obj.el.parentNode) {
          obj.el.parentNode.removeChild(obj.el);
        }
      });
      leeks = [];
    }

    function stopGameTimers() {
      clearInterval(spawnTimer);
      clearInterval(moveTimer);
      clearInterval(speedLevelTimer);
      spawnTimer = null;
      moveTimer = null;
      speedLevelTimer = null;
    }

    function setInvincible(on) {
      invincible = on;
      if (on) {
        bodyEl.classList.add("invincible");
        setStatusText("ç„¡æ•µã‚¿ã‚¤ãƒ ä¸­ï¼ãƒŸã‚¹ã—ã¦ã‚‚æ¸›ç‚¹ãªã—âœ¨");
      } else {
        bodyEl.classList.remove("invincible");
        setStatusText("");
      }
    }

    // ==== ãƒã‚®ã‚’ä½œã£ã¦æµã™ =====================
    function spawnLeek() {
      if (!gameRunning) return;

      const rand = Math.random();
      let typeGroup;
      let kind;

      // å‡ºç¾ç¢ºç‡ï¼š
      //   good 70%ï¼ˆ3ç¨®é¡ã§å‰²ã‚‹ï¼‰
      //   bad 25%
      //   gold 5%
      if (rand < 0.70) {
        typeGroup = NEGI_TYPES.good;
        kind = "good";
      } else if (rand < 0.95) {
        typeGroup = NEGI_TYPES.bad;
        kind = "bad";
      } else {
        typeGroup = NEGI_TYPES.gold;
        kind = "gold";
      }

      const data = typeGroup[Math.floor(Math.random() * typeGroup.length)];

      const img = document.createElement("img");
      img.src = "images/"+data.file;
      img.alt = data.name;
      img.className = "leek";

      // ãƒ¬ãƒ¼ãƒ³ã®ä¸­å¤®ã«ç«‹ã¦ã‚‹
      const laneRect = laneHelper.getBoundingClientRect();
      const gameRect = gameArea.getBoundingClientRect();

      const yBottom = gameRect.height * 0.20; // ä¸‹ã‹ã‚‰ã¡ã‚‡ã£ã¨ä¸Šã’ã‚‹
      img.style.bottom = yBottom + "px";

      // ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®ï¼ˆç”»é¢ã®å·¦å¤–ï¼‰
      img.style.left = -30 + "vw";

      // ã‚¿ãƒƒãƒ—å‡¦ç†
      img.addEventListener("click", () => handleTapLeek(obj));
      img.addEventListener("touchend", (e) => {
        e.preventDefault();
        handleTapLeek(obj);
      });

      gameArea.appendChild(img);

      const obj = {
        el: img,
        kind,
        name: data.name,
        x: -gameRect.width * 0.25,  // å·¦å¤–ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
        speed: speed + Math.random() * 0.8, // å°‘ã—ãƒãƒ©ã¤ã
        width: 0                 // å¾Œã§ã‚»ãƒƒãƒˆ
      };

      // width ã¯å®Ÿéš›ã«æç”»ã•ã‚Œã¦ã‹ã‚‰
      requestAnimationFrame(() => {
        obj.width = img.getBoundingClientRect().width || 80;
      });

      leeks.push(obj);
    }

    function moveLeeks() {
      if (!gameRunning) return;

      const gameRect = gameArea.getBoundingClientRect();
      const removeList = [];

      leeks.forEach(obj => {
        obj.x += obj.speed;
        obj.el.style.left = obj.x + "px";

        if (obj.x > gameRect.width) {
          // å³ç«¯ã¾ã§æµã‚Œåˆ‡ã£ãŸ
          handleLeekReachedRight(obj);
          removeList.push(obj);
        }
      });

      // ã„ãªããªã£ãŸãƒã‚®ã‚’å‰Šé™¤
      removeList.forEach(obj => {
        if (obj.el && obj.el.parentNode) {
          obj.el.parentNode.removeChild(obj.el);
        }
        const idx = leeks.indexOf(obj);
        if (idx >= 0) leeks.splice(idx, 1);
      });
    }

    // ==== ã‚¹ã‚³ã‚¢åˆ¤å®š =====================
    function handleLeekReachedRight(obj) {
      if (obj.kind === "good") {
        // è‰¯ã„ãƒã‚®ï¼šå³ã¾ã§æµã—ãŸã‚‰ +1ç‚¹
        updateScore(1);
      } else if (obj.kind === "bad") {
        // æ‚ªã„ãƒã‚®ï¼šå³ã¾ã§æµã‚Œã‚‹ã¨ -1ç‚¹ï¼ˆç„¡æ•µä¸­ã¯æ¸›ç‚¹ãªã—ï¼‰
        if (!invincible) updateScore(-1);
      } else if (obj.kind === "gold") {
        // é‡‘ãƒã‚®ï¼šå³ã¾ã§è¡Œã£ãŸã‚‰ +1ç‚¹
        updateScore(1);
      }
    }

    function handleTapLeek(obj) {
      if (!gameRunning || !obj.el) return;

      // ã™ã§ã«å‰Šé™¤æ¸ˆã¿ãªã‚‰ä½•ã‚‚ã—ãªã„
      if (!gameArea.contains(obj.el)) return;

      if (obj.kind === "good") {
        // è‰¯ã„ãƒã‚®ã‚’é–“é•ãˆã¦ã‚¿ãƒƒãƒ— â†’ -1ç‚¹ï¼ˆç„¡æ•µä¸­ã¯æ¸›ç‚¹ãªã—ï¼‰
        if (!invincible) {
          updateScore(-1);
          setStatusText("ã‚ã£â€¦è‰¯ã„ãƒã‚®ã‚’å–ã£ã¡ã‚ƒã£ãŸğŸ’¦");
          setTimeout(() => setStatusText(""), 800);
        }
      } else if (obj.kind === "bad") {
        // æ‚ªã„ãƒã‚®ã‚’ã‚¿ãƒƒãƒ—ã§0ç‚¹ï¼ˆæ­£ã—ã„å‡¦ç†ï¼‰
        // æ¼”å‡ºã ã‘
        setStatusText("å‚·ã‚“ã ãƒã‚®ã‚’å–ã‚Šé™¤ã„ãŸã‚ˆğŸ‘Œ");
        setTimeout(() => setStatusText(""), 600);
      } else if (obj.kind === "gold") {
        // é‡‘ãƒã‚®ï¼š+10ç‚¹ & ç„¡æ•µ5ç§’
        updateScore(10);
        setStatusText("é‡‘ãƒã‚®ã‚²ãƒƒãƒˆï¼5ç§’é–“ç„¡æ•µã ã‚ˆâœ¨");
        setInvincible(true);
        clearTimeout(invincibleTimeoutId);
        invincibleTimeoutId = setTimeout(() => {
          setInvincible(false);
        }, 5000);
      }

      // ãƒã‚®ã‚’æ¶ˆã™
      if (obj.el && obj.el.parentNode) {
        obj.el.parentNode.removeChild(obj.el);
      }
      const idx = leeks.indexOf(obj);
      if (idx >= 0) leeks.splice(idx, 1);
    }

    // ==== ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ»çµ‚äº† =====================
    function startGame() {
      score = 0;
      updateScore(0); // è¡¨ç¤ºã‚’0ã«
      clearAllLeeks();
      stopGameTimers();
      setStatusText("ç™½ãƒã‚®ã‚’é¸åˆ¥ä¸­â€¦");
      setInvincible(false);

      gameRunning = true;
      speed = BASE_SPEED;

      startBtn.textContent = "ãƒ—ãƒ¬ã‚¤ä¸­â€¦";
      startBtn.disabled = true;
      retryBtn.style.display = "none";

      spawnTimer = setInterval(spawnLeek, SPAWN_INTERVAL);
      moveTimer = setInterval(moveLeeks, 1000 / 60); // 60fpsãã‚‰ã„
      speedLevelTimer = setInterval(() => {
        speed += SPEED_UP_AMOUNT;
      }, SPEED_UP_INTERVAL);
    }

    function stopGame() {
      gameRunning = false;
      stopGameTimers();
      setInvincible(false);
      setStatusText("åç©«çµ‚äº†ï¼");
      startBtn.textContent = "åç©«é–‹å§‹ï¼";
      startBtn.disabled = false;
      retryBtn.style.display = "inline-block";
    }

    // ==== ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š =========================
    startBtn.addEventListener("click", () => {
      startGame();

      // 30ç§’çµŒã£ãŸã‚‰ä¸€æ—¦çµ‚äº†ã™ã‚‹ç°¡æ˜“ãƒ«ãƒ¼ãƒ«
      setTimeout(() => {
        if (gameRunning) {
          stopGame();
          alert("30ç§’ã®åç©«ã‚¿ã‚¤ãƒ çµ‚äº†ï¼\nã‚¹ã‚³ã‚¢: " + score);
        }
      }, 30000);
    });

    retryBtn.addEventListener("click", () => {
      startGame();
    });

    // ç”»é¢ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã£ãŸã¨ãç”¨ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ãŒä¸€ç•ªãƒ©ã‚¯ã ã‘ã©å¿µã®ãŸã‚ï¼‰
    window.addEventListener("resize", () => {
      // ä½ç½®è¨ˆç®—ã‚’å°‘ã—ãƒªã‚»ãƒƒãƒˆ
      leeks.forEach(obj => {
        obj.x = parseFloat(obj.el.style.left) || obj.x;
      });
    });
  </script>
</body>
</html>
